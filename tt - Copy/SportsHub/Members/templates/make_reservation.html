{% extends 'Navbar.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Make Reservation</title>
    <!-- Add your CSS stylesheets or link to external stylesheets here -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Your CSS styles here */
       
          .card-body {
              padding: 0;
          }
      
          .table td {
              vertical-align: middle;
          }
      
          .toggle-button {
              cursor: pointer;
          }
     
    </style>
</head>
<body>
    <h1>Make Equipment Reservation</h1>
    <form method="post">
        {% csrf_token %}

        <!-- Equipment Selection with Bootstrap styles -->
        <div class="container">
            <div class="row">
                {% for equipment, days in available_slots.items %}
                    <div class="col-md-4 d-flex">
                        <div class="card">
                            <div class="card-header">
                                Equipment: {{ equipment.name }}
                            </div>
                            <div class="card-body" style="display: none;">
                                <table class="table table-bordered">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Day</th>
                                            <th>Available Slots</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for day, slots in days.items %}
                                            <tr>
                                                <td>{{ day }}</td>
                                                <td>
                                                    <div class="form-group">
                                                        <select class="form-control" name="selected_slot_{{ equipment.id }}_{{ day }}">
                                                            {% for timeslot in slots %}
                                                                <option value="{{ timeslot.id }}" data-equipment-id="{{ equipment.id }}" data-date="{{ day }}">{{ timeslot.start_time }} - {{ timeslot.end_time }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- User Selection with Bootstrap styles -->
        <div class="form-group">
            <label for="selected_user">Select User:</label>
            <select class="form-control" name="selected_user" id="selected_user">
                <option value="" selected disabled>Select User</option>
                {% for user in connected_users %}
                    <option value="{{ user.id }}">{{ user.user.username }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Date Selection with Bootstrap styles -->
        <div class="form-group">
            <label for="selected_date">Select Date:</label>
            <input type="text" id="selected_date" name="datee" class="form-control">
        </div>

        <!-- Hidden input fields to store selected values -->
        <input type="hidden" name="selected_slot" id="selected_slot">
        <input type="hidden" name="selected_equipment" id="selected_equipment">

        <!-- Submit Button with Bootstrap styles -->
        <button class="btn btn-primary" type="submit">Reserve</button>
    </form>

    <a href="{% url 'Members:fitness_user_dashboard' %}">Back to Dashboard</a>

    <!-- Include Bootstrap JavaScript (optional) -->
      <!-- Include Bootstrap JavaScript (optional) -->
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
      <!-- jQuery and JavaScript code for capturing selections (place this at the end) -->
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script>
          // Attach click event listeners to slot inputs
// Attach change event listeners to slot selection dropdowns
$("select[name^='selected_slot']").on('change', function () {
  var selectedDate = $(this).find('option:selected').data('date');
  var parsedDate = new Date(selectedDate);
  console.log(parsedDate);
  var selectedEquipment = $(this).find('option:selected').data('equipment-id');
  var selectedSlot = $(this).val();

  // Update the selected_date, selected_equipment, and selected_slot fields
  document.getElementById('selected_date').value = selectedDate;
  document.getElementById('selected_equipment').value = selectedEquipment;
  document.getElementById('selected_slot').value = selectedSlot;
});


    $(document).ready(function() {
        // Toggle card body when clicking on the card header
        $(".card-header").click(function() {
            $(this).next(".card-body").toggle();
        });
    });



  
          // Attach click event listeners to equipment inputs
          $("input[name='selected_equipment']").on('change', function () {
              var selectedEquipment = this.value;
  
              // Update the selected_equipment field
              document.getElementById('selected_equipment').value = selectedEquipment;
          });
          $(function () {
              $("#selected_date").datepicker({
                  dateFormat: "yy-mm-dd",
                  minDate: 0, // Allow selecting only future dates
                  onSelect: function (selectedDate) {
                      // Log the selected date for debugging
                      console.log("Selected Date:", selectedDate); 
                      
                      // Set the value of the input element
                      document.getElementById('selected_date').value = selectedDate;
                  }
              });
          });
          
      </script>
</body>
</html>
{% endblock %}
