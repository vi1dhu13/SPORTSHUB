{% extends 'Navbar.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Make Reservation</title>
    <!-- Add your CSS stylesheets or link to external stylesheets here -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        :root {
            --card-line-height: 1.2em;
            --card-padding: 1em;
            --card-radius: 0.5em;
            --color-green: #558309;
            --color-gray: #e2ebf6;
            --color-dark-gray: #c4d1e1;
            --radio-border-width: 2px;
            --radio-size: 1.5em;
          }
          

          
          .grid {
            display: grid;
            grid-gap: var(--card-padding);
            max-width: 60em;
            padding: 0;
           
            @media (min-width: 42em) {
              grid-template-columns: repeat(3, 1fr);
            }
          }
          
          .card {
            background-color: #fff;
            border-radius: var(--card-radius);
            position: relative;
            
            &:hover {
              box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.15);
            }
          }
          
          .radio {
            font-size: inherit;
            margin: 0;
            position: absolute;
            right: calc(var(--card-padding) + var(--radio-border-width));
            top: calc(var(--card-padding) + var(--radio-border-width));
          }
          
          @supports(-webkit-appearance: none) or (-moz-appearance: none) { 
            .radio {
              -webkit-appearance: none;
              -moz-appearance: none;
              background: #fff;
              border: var(--radio-border-width) solid var(--color-gray);
              border-radius: 50%;
              cursor: pointer;
              height: var(--radio-size);
              outline: none;
              transition: 
                background 0.2s ease-out,
                border-color 0.2s ease-out;
              width: var(--radio-size); 
          
              &::after {
                border: var(--radio-border-width) solid #fff;
                border-top: 0;
                border-left: 0;
                content: '';
                display: block;
                height: 0.75rem;
                left: 25%;
                position: absolute;
                top: 50%;
                transform: 
                  rotate(45deg)
                  translate(-50%, -50%);
                width: 0.375rem;
              }
          
              &:checked {
                background: var(--color-green);
                border-color: var(--color-green);
              }
            }
            
            .card:hover .radio {
              border-color: var(--color-dark-gray);
              
              &:checked {
                border-color: var(--color-green);
              }
            }
          }
          
          .plan-details {
            border: var(--radio-border-width) solid var(--color-gray);
            border-radius: var(--card-radius);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            padding: var(--card-padding);
            transition: border-color 0.2s ease-out;
          }
          
          .card:hover .plan-details {
            border-color: var(--color-dark-gray);
          }
          
          .radio:checked ~ .plan-details {
            border-color: var(--color-green);
          }
          
          .radio:focus ~ .plan-details {
            box-shadow: 0 0 0 2px var(--color-dark-gray);
          }
          
          .radio:disabled ~ .plan-details {
            color: var(--color-dark-gray);
            cursor: default;
          }
          
          .radio:disabled ~ .plan-details .plan-type {
            color: var(--color-dark-gray);
          }
          
          .card:hover .radio:disabled ~ .plan-details {
            border-color: var(--color-gray);
            box-shadow: none;
          }
          
          .card:hover .radio:disabled {
              border-color: var(--color-gray);
            }
          
          .plan-type {
            color: var(--color-green);
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1em;
          }
          
          .plan-cost {
            font-size: 2.5rem;
            font-weight: bold;
            padding: 0.5rem 0;
          }
          
          .slash {
            font-weight: normal;
          }
          
          .plan-cycle {
            font-size: 2rem;
            font-variant: none;
            border-bottom: none;
            cursor: inherit;
            text-decoration: none;
          }
          
          .hidden-visually {
            border: 0;
            clip: rect(0, 0, 0, 0);
            height: 1px;
            margin: -1px;
            overflow: hidden;
            padding: 0;
            position: absolute;
            white-space: nowrap;
            width: 1px;
          }
    </style>
</head>
<body>
    <h1>Make Equipment Reservation</h1>
    <form method="post">
        {% csrf_token %}

        <!-- Equipment Selection Table with Bootstrap styles -->
        <table class="table table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>Equipment</th>
                    <th>Available Slots</th>
                </tr>
            </thead>
            <tbody>
                {% for equipment, days in available_slots.items %}
                    <tr>
                        <td>{{ equipment.name }}</td>
                        <td>
                            <ul>
                                {% for day, slots in days.items %}
                                    <li>
                                        {{ day }}:
                                        <ul>
                                            {% for timeslot in slots %}
                                                
                                                    <div class="form-check">
                                                        <div class="grid">
                                                            <label class="card">
                                                              <input class="form-check-input radio" type="radio" name="selected_slot" value="{{ timeslot.id }}" data-equipment-id="{{ equipment.id }}" data-date="{{ day }}">
                                                              
                                                              <span class="plan-details">
                                                                <span class="plan-type">Timing</span>
                                                                <span>{{ timeslot.start_time }} - {{ timeslot.end_time }}</span>                                                                
                                                              </span>
                                                            </label>
                                                            
                                                          </div>                                                        
                                                          <input hidden type="text" name="equipment_input" value="{{equipment.id}}">
                                                        
                                                    </div>
                                                
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% endfor %}
                            </ul>
                        </td>
                        
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- User Selection with Bootstrap styles -->
        <div class="form-group">
            <label for="selected_user">Select User:</label>
            <select class="form-control" name="selected_user" id="selected_user">
                <option value="" selected disabled>Select User</option>
                {% for user in connected_users %}
                    <option value="{{ user.id }}">{{ user.user.username }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Date Selection with Bootstrap styles -->
        <label for="selected_date">Select Date:</label>
        <input type="text" id="selected_date" name="datee">
        <div id="available_slots_container"></div>

        <!-- Hidden input fields to store selected values -->
        <input type="hidden" name="selected_slot" id="selected_slot">
        <input type="hidden" name="selected_equipment" id="selected_equipment">

        <!-- Submit Button with Bootstrap styles -->
        <button class="btn btn-primary" type="submit">Reserve</button>
    </form>

    <a href="{% url 'Members:fitness_user_dashboard' %}">Back to Dashboard</a>

    <!-- Include Bootstrap JavaScript (optional) -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <!-- jQuery and JavaScript code for capturing selections (place this at the end) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Attach click event listeners to slot inputs
        $("input[name='selected_slot']").on('change', function () {
            
            var selectedDate = $(this).data('date');
            var parsedDate = new Date(selectedDate);
            console.log(parsedDate)
            var selectedEquipment = $(this).data('equipment-id');
            var selectedSlot = this.value;

            // Update the selected_date, selected_equipment, and selected_slot fields
            document.getElementById('selected_date').value = selectedDate;
            console.log(selected_date.value)
            document.getElementById('selected_equipment').value = selectedEquipment;
            document.getElementById('selected_slot').value = selectedSlot;
        });
        console.log("Formatted Date:", selectedDate);
        document.getElementById('selected_date').value = selectedDate;
 

        // Attach click event listeners to equipment inputs
        $("input[name='selected_equipment']").on('change', function () {
            var selectedEquipment = this.value;

            // Update the selected_equipment field
            document.getElementById('selected_equipment').value = selectedEquipment;
        });
        $(function () {
            $("#selected_date").datepicker({
                dateFormat: "yy-mm-dd",
                minDate: 0, // Allow selecting only future dates
                onSelect: function (selectedDate) {
                    // Log the selected date for debugging
                    console.log("Selected Date:", selectedDate); 
                    
                    // Set the value of the input element
                    document.getElementById('selected_date').value = selectedDate;
                }
            });
        });
        
    </script>
</body>
</html>
{% endblock %}