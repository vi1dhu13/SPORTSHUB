{% load static %}
{% load socialaccount %}
<!DOCTYPE html>
<html>

<head>
   <meta charset="utf-8"> 
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <title></title>
   <meta name="description" content="">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="shortcut icon" href="{% static 'ftco-32x32.png' %}">

   <link href="https://fonts.googleapis.com/css?family=Muli:300,400,700,900" rel="stylesheet">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+VAdr3k6cqGpPjXkbJHIuM/CJ5InAI6fDj4sD6k/KJmJiS" crossorigin="anonymous">
 
   <link rel="stylesheet" href="{% static 'fonts/icomoon/style.css' %}">

   <link rel="stylesheet" type="text/css" href="{% static 'assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/font-awesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/templatemo-training-studio.css' %}">
 
 
   <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
   <link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}">
   <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
   <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
   <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
 
   <link rel="stylesheet" href="{% static 'css/jquery.fancybox.min.css' %}">
 
   <link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.css' %}">
 
   <link rel="stylesheet" href="{% static 'fonts/flaticon/font/flaticon.css' %}">
 
   <link rel="stylesheet" href="{% static 'css/aos.css' %}">
   <link href="{% static 'css/jquery.mb.YTPlayer.min.css' %}" media="all" rel="stylesheet" type="text/css">
 
   <link rel="stylesheet" href="{% static 'css/style.css' %}">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
      crossorigin="anonymous"></script>
      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <style>
          
            /* Custom styles for the form */
            form {
              margin-top: 20px;
            }
        
            /* Style form labels */
            label {
              font-weight: bold;
              color: #264653!important; ;
            }
        
            /* Style form fields */
            .form-group {
              margin-bottom: 20px;
            }
        
            /* Style input fields */
            input[type="text"],
            input[type="email"],
            input[type="password"],
            select {
              background-color: #444;
              color: #fff;
              border: 1px solid #555;
              width: 100%; /* Make input fields longer */
              padding: 10px; /* Add some padding for better appearance */
              box-sizing: border-box; /* Include padding in width calculation */
            }
        
            /* Style submit button */
            .btn-primary {
              background-color: #4285F4;
              border-color: #4285F4;
            }
        
            /* Additional styles for the second form section */
            .form-row {
              margin-top: 20px;
            }
            .card {
                
                background-color: 	#d3d3d3
                padding: 1em;
                
                box-shadow: 4px 4px 20px rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                
                transition: 200ms ease-in-out;
              }
              
              .username {
                color: #C6E1ED;
                font-size: 0.85em;
                font-weight: 600;
              }
              
              .body {
                display: flex;
                flex-direction: column;
              }
              
              .body .text {
                margin: 0 10px 0 0;
                white-space: pre-line;
                color: #264653!important; 
                font-weight: 400;
                line-height: 1.5;
                margin-bottom: 4px;
              }
              
              .footer {
                position: relative;
                width: 100%;
                color: #9fa4aa;
                font-size: 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                border: none;
                margin-top: 10px;
              }
              
              .footer div {
                margin-right: 1rem;
                height: 20px;
                display: flex;
                align-items: center;
                cursor: pointer;
              }
              
              .footer svg {
                margin-right: 5px;
                height: 100%;
                stroke: #9fa4aa;
              }
              
              .viewer span {
                height: 20px;
                width: 20px;
                background-color: rgb(28, 117, 219);
                margin-right: -6px;
                border-radius: 50%;
                border: 1px solid #fff;
                display: grid;
                align-items: center;
                text-align: center;
                font-weight: bold;
                font-size: 8px;
                color: #fff;
                padding: 2px;
              }
              
              .viewer span svg {
                stroke: #fff;
              }
          #available_slots {
              margin-top: 20px;
              padding: 10px;
              background-color: #fff;
              border: 1px solid #ddd;
              border-radius: 5px;
              box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
          }
      
          #available_slots p {
              margin: 5px 0;
              padding: 5px;
              background-color: #f5f5f5;
              border: 1px solid #ccc;
              border-radius: 5px;
          }
      </style>
</head>
      <header class="header-area header-sticky"  style="background:  #000000;">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <a href="index.html" class="logo">Sports<em>Hup</em></a>
                        <!-- ***** Logo End ***** -->
                        <!-- ***** Menu Start ***** -->
                        <ul class="nav">
                            <li class="scroll-to-section"><a href="{% url 'Members:fitness_trainer_dashboard' %}" >Home</a>
                            
                            <li class="scroll-to-section"><a href="{% url 'Members:view_pending_requests' %}">View Requests</a>
                            <li class="scroll-to-section"><a href="{% url 'Members:create_training_plan' %}">Create Plan</a>
                        
                            
                            <li class="scroll-to-section"><a href="{% url 'Members:make_reservation'  %}">Make Reservations</a></li> 
                            
                        </ul>        
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                        <!-- ***** Menu End ***** -->
                    </nav>
                </div>
            </div>
        </div>
    </header>
   
  
    <div class="container" style="margin-top: 90px;">


        <!-- Equipment Reservation Form -->
        <form id="reservation-form">
            {% csrf_token %}

            <div class="form-group">
                <label for="reservation_date">Reservation Date:</label>
                <input type="date" id="reservation_date" name="reservation_date" class="form-control">
            </div>
            <button id="check_availability" type="button" class="btn btn-primary">Check Availability</button>

            <!-- Display Available Slots -->
            <div class="form-group mt-4">
                <label for="selected_user">Select User:</label>
                <select class="form-control" name="selected_user" id="selected_user">
                    <option value="" selected disabled>Select User</option>
                    {% for user in connected_users %}
                        <option value="{{ user.id }}">{{ user.user.username }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Available Slots -->
            <div class="form-group" id="available_slots" style="color: #a60000; background-color: rgb(255, 255, 255);">
                <!-- Available slots will be displayed here -->
            </div>
            

            <!-- Selected Slot Input -->
            <div class="form-group" >
                <label for="selected_slot_id">Selected </label>
                <input type="text"name="selected_slot" id="selected_slot" style="color: #a60000; background-color: #fcfcfc;">
                <input type="hidden" id="selected_slot_id" name="selected_slot_id" readonly class="form-control " style="color: #a60000; background-color: #fcfcfc;">
            </div>

            <!-- Hidden Input Fields -->
            <input type="hidden" name="selected_slot" id="selected_slot">
            <input type="hidden" name="selected_equipment" id="selected_equipment">

            <!-- Make Reservation Button -->
            <button type="submit" id="make_reservation" class="btn btn-success">Make Reservation</button>
        </form>
    </div>
</center>
    </div>

<!-- AJAX Script -->
<!-- AJAX Script -->

<script>
    $(document).ready(function() {
        // Variable to store the selected slot
        var selectedSlotText = "";
        var selectedSlotId = null; // Variable to store the selected slot ID
    
        // AJAX request when the "Check Availability" button is clicked
        $('#check_availability').click(function() {
            
            var date = $('#reservation_date').val();
    
            $.ajax({
                url: '/members/get_available_slots/',
                data: {
                   
                    date: date
                },
                dataType: 'json',
                success: function(data) {
                    // Clear previous results
                    $('#available_slots').empty();
    
                    if (data.available_slots.length === 0) {
                        $('#available_slots').append('<p>No available slots</p>');
                    } else {
                        $.each(data.available_slots, function(index, slot) {
                            // Display each available slot and make it selectable
                            var slotElement = $('<p class="selectable-slot" data-slot-id="' + slot.slot_id + '">' + slot.start_time + ' - ' + slot.end_time + '</p>');
                            slotElement.click(function() {
                                // Set the selected slot text and update the input field
                                selectedSlotText = slot.start_time + ' - ' + slot.end_time;
                                selectedSlotId = slot.slot_id; // Store the selected slot ID
                                $('#selected_slot').val(selectedSlotText);
                                $('#selected_slot_id').val(selectedSlotId); 
                            });
                            $('#available_slots').append(slotElement);
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', status, error);
                }
            });
        });
    
        // AJAX request when the "Make Reservation" button is clicked
        $('#make_reservation').click(function() {
            // Your code to retrieve form data goes here
            var selected_slot_id = $('#selected_slot_id').val();
            var selected_user_id = $('#selected_user').val();
            var selected_date = $('#reservation_date').val();
            
    
            // Send a POST request to create the reservation
            $.ajax({
                url: '/members/c_reservation/',
                method: 'POST',
                data: {
                    selected_slot: selected_slot_id,
                    selected_user: selected_user_id,
                    reservation_date: selected_date,
                    
                    csrfmiddlewaretoken: '{{ csrf_token }}', // Include the CSRF token
                },
                dataType: 'json',
                success: function(data) {
                    console.log('Reservation created successfully!');
                    
                    // Display the success message
                    $('#success-message').fadeIn(); // Show the success message
                
                    // Set a timer to hide the success message after 3 seconds
                    setTimeout(function() {
                        $('#success-message').fadeOut(); // Hide the success message
                    }, 3000); // 3000 milliseconds = 3 seconds
                
                    // You can also hide the form or perform other actions
                    // For example, you can hide the form after a successful reservation
                    $('#reservation-form').hide();
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', status, error);
                    // Handle the error response if needed
                    showErrorMessage('Error: Unable to make reservation');
                }
            });
        });
        
    });
    
</script>
<script>
    // Get the current date
    var currentDate = new Date();

    // Calculate the date for tomorrow
    var tomorrow = new Date(currentDate);
    tomorrow.setDate(currentDate.getDate() + 1);

    // Calculate the date for 7 days from tomorrow
    var nextWeekDate = new Date(tomorrow);
    nextWeekDate.setDate(tomorrow.getDate() + 7);

    // Create an array to store the next 7 days
    var availableDates = [];
    while (tomorrow <= nextWeekDate) {
        var formattedDate = tomorrow.toISOString().split('T')[0];
        availableDates.push(formattedDate);
        tomorrow.setDate(tomorrow.getDate() + 1);
    }

    // Set the min and max attributes of the input element
    var dateInput = document.getElementById('reservation_date');
    dateInput.min = availableDates[0]; // Set the minimum date
    dateInput.max = availableDates[availableDates.length - 1]; // Set the maximum date

    // Populate the list of available options
    availableDates.forEach(function (date) {
        var option = document.createElement('option');
        option.value = date;
        option.text = date;
        dateInput.appendChild(option);
    });
</script>








</body>
</html>